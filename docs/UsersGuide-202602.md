# PointMarker 利用者の手引
**Version 2026年2月版 v6.0**

## はじめに
PointMarkerは、ハイキングマップ画像上に多様な情報をマーキングし、デジタルデータとして統合管理するWebアプリケーションです。v6.0では、新たに「エリア編集」機能が追加され、危険箇所や植生範囲などの面的な情報を記録できるようになりました。また、データの保存形式が一本化され、より簡単にデータを管理できます。

### v6.0の主要な新機能
- **エリア編集機能**: 多角形による面的な領域（エリア）の作成・編集
- **設定データ一元化**: ポイント・ルート・スポット・エリアを1つのJSONファイルにまとめて保存
- **マーカー設定**: 各種マーカーのサイズを自由に変更できる設定画面
- **UI改善**: 編集モードごとの表示制御の最適化

## 基本的な使い方

### 1. アプリケーションの起動と画像読み込み
1. ローカルサーバー（`python -m http.server 8000` 等）を起動し、ブラウザでアクセスします。
2. **「PNG画像を読み込み」**ボタンを押し、マップ画像（PNG形式）を選択します。

### 2. 編集モードの切り替え
画面右上のパネルにあるラジオボタンで、4つの編集モードを切り替えます：
- **ポイント編集**: 地点（山頂、分岐など）の記録
- **ルート編集**: 通行ルートの作成
- **スポット編集**: 観光スポットなどの場所の記録
- **エリア編集**: **(NEW)** 面的な領域の記録

### 3. エリアの作成と編集 (新機能)
危険箇所や特定の区域を多角形で記録します。

#### エリアの作成
1. 「エリア編集」モードを選択します。
2. **「追加」**ボタンを押すと、新しいエリアが作成されます。
3. エリア名入力欄に名前（例：「崩落箇所」「植生保護区」）を入力します。
4. 地図上をクリックして頂点を配置していきます。
   - 3つ以上の頂点を配置すると多角形が形成されます。
   - 頂点は自動的に重心順に並び替えられ、きれいな形が保たれます。

#### エリアの修正
- **頂点移動**: 緑色の頂点マーカーをドラッグして形状を修正します。
- **頂点追加**: 選択中のエリア内で地図をクリックすると、新しい頂点が追加されます。
- **エリア切り替え**: ドロップダウンリストから編集したいエリアを選択します。

### 4. データの保存と読み込み (変更点)
v6.0より、すべてのデータ（ポイント・ルート・スポット・エリア）が**1つのファイル**で管理されるようになりました。

#### 保存（エクスポート）
1. 右上のパネルにある**「保存」**ボタンをクリックします。
2. 自動的にファイル名が生成されます（例：`MapName_P10_R2_S5_A1.json`）。
   - P=ポイント数, R=ルート数, S=スポット数, A=エリア数
3. タブレットやPCにJSONファイルとして保存されます。

#### 読み込み（インポート）
1. **「読み込み」**ボタンをクリックします。
2. 以前保存したJSONファイルを選択します。
3. すべてのマーカーとエリアが地図上に復元されます。

### 5. マーカーサイズの設定 (新機能)
ご使用のディスプレイや好みに合わせて、マーカーの大きさを調整できます。

1. 画面右下の **設定ボタン（⚙️アイコン）** をクリックします。
2. 設定ダイアログが表示されます。
3. 各項目のスライダーを動かすか、数値を入力してサイズを変更します。
   - **ポイント**: 赤い円のサイズ
   - **選択ルート中間点**: 編集中のルートの中間点（橙色）
   - **非選択ルート中間点**: 編集対象外のルートの中間点
   - **スポット**: 青い四角形のサイズ
   - **エリア頂点**: エリア構成点のサイズ
4. **「OK」**を押すと設定が保存され、次回以降も適用されます。

## 機能詳細

### データベース連携（オプション）
設定ダイアログの「データベース」タブから、Firebase（クラウドデータベース）への保存・読み込みが行えます。
- **読み込み**: クラウド上の最新データを取得して表示します。
- **保存**: 現在の作業内容をクラウドに上書き保存します。
※ この機能を使用するには、別途Firebaseの設定が必要です。

### キーボードショートカット
- **Delete / Backspace**: （入力欄フォーカス時）文字削除
- **Escape**: ダイアログを閉じる、または入力のキャンセル

## トラブルシューティング
- **Q. エリアの形がおかしい**: 頂点は自動的に中心から見て時計回り/反時計回りに整列されます。複雑な凹凸のある形状は表現できない場合があります。その場合は複数のエリアに分けて作成してください。
- **Q. 保存ボタンがない**: 画像を読み込んだ後に表示されます。まずはマップ画像を読み込んでください。
